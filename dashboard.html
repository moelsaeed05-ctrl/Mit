<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MIT STORE - Admin Dashboard</title>

<style>
body{
background:#111;
color:white;
font-family:Arial;
text-align:center;
margin:0;
}

h1{margin:20px;}

.container{padding:20px;}

input,select{
padding:10px;
margin:5px;
width:220px;
}

button{
padding:10px 15px;
margin:5px;
background:#ffd700;
border:none;
cursor:pointer;
font-weight:bold;
}

.logout{
background:red;
color:white;
position:absolute;
top:20px;
right:20px;
}

.product{
background:#222;
margin:15px auto;
padding:15px;
width:250px;
border-radius:10px;
}

.product img{
width:100%;
border-radius:10px;
}

.delete{
background:red;
color:white;
margin-top:10px;
}
</style>
</head>
<body>

<h1>MIT STORE - ADMIN</h1>
<button class="logout" onclick="logout()">Logout</button>

<div class="container">

<h2>Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬</h2>

<input type="text" id="name" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬"><br>
<input type="number" id="price" placeholder="Ø§Ù„Ø³Ø¹Ø±"><br>
<input type="file" id="imageFile"><br>

<select id="category">
<option value="">Ø§Ø®ØªØ± Ø§Ù„ÙØ¦Ø©</option>
<option value="HOODIES">HOODIES</option>
<option value="PANTS">PANTS</option>
<option value="ACCESSORIES">ACCESSORIES</option>
</select><br>

<button onclick="addProduct()">Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬</button>

<h2>Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h2>
<div id="products"></div>

</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut }
from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc }
from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
import { getStorage, ref, uploadBytes, getDownloadURL }
from "https://www.gstatic.com/firebasejs/10.12.2/firebase-storage.js";

const firebaseConfig={
apiKey:"AIzaSyA1X_1BlviMDKKUGnA8yfG6NCrfS65h524",
authDomain:"mit-store-bd580.firebaseapp.com",
projectId:"mit-store-bd580",
storageBucket:"mit-store-bd580.firebasestorage.app",
messagingSenderId:"382577223227",
appId:"1:382577223227:web:71a4945a81cfbb9e06de1e"
};

const app=initializeApp(firebaseConfig);
const auth=getAuth(app);
const db=getFirestore(app);
const storage=getStorage(app);

const productsDiv=document.getElementById("products");


// ğŸ” Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø£Ø¯Ù…Ù†
onAuthStateChanged(auth,async(user)=>{
if(!user){
const email=prompt("Ø§Ø¯Ø®Ù„ Ø§ÙŠÙ…ÙŠÙ„ Ø§Ù„Ø§Ø¯Ù…Ù†");
const pass=prompt("Ø§Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±");
await signInWithEmailAndPassword(auth,email,pass);
return;
}

const adminSnap = await getDoc(doc(db,"admins",user.uid));

if(!adminSnap.exists()){
alert("ØºÙŠØ± Ù…ØµØ±Ø­ Ù„Ùƒ Ø¨Ø§Ù„Ø¯Ø®ÙˆÙ„");
await signOut(auth);
return;
}

loadProducts();
}); // â† Ø§Ù„Ù‚ÙˆØ³ Ø¯Ù‡ ÙƒØ§Ù† Ù†Ø§Ù‚Øµ
// â• Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬
window.addProduct=async function(){

const name=document.getElementById("name").value;
const price=document.getElementById("price").value;
const category=document.getElementById("category").value;
const file=document.getElementById("imageFile").files[0];

if(!name||!price||!category||!file){
alert("Ø§Ù…Ù„Ù‰ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");
return;
}

// Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©
const storageRef=ref(storage,"products/"+Date.now()+file.name);
await uploadBytes(storageRef,file);
const imageURL=await getDownloadURL(storageRef);

// Ø­ÙØ¸ Ø§Ù„Ù…Ù†ØªØ¬
await addDoc(collection(db,"products"),{
name,
price,
image:imageURL,
category
});

alert("ØªÙ… Ø§Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬ ğŸ”¥");
loadProducts();
}


// ğŸ“¦ Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
async function loadProducts(){
productsDiv.innerHTML="";
const snapshot=await getDocs(collection(db,"products"));

snapshot.forEach((docSnap)=>{
const data=docSnap.data();

productsDiv.innerHTML+=`
<div class="product">
<img src="${data.image}">
<h3>${data.name}</h3>
<p>${data.price} EGP</p>
<p>${data.category}</p>
<button class="delete" onclick="deleteProduct('${docSnap.id}')">Ø­Ø°Ù</button>
</div>
`;
});
}


// âŒ Ø­Ø°Ù Ù…Ù†ØªØ¬
window.deleteProduct=async function(id){
await deleteDoc(doc(db,"products",id));
alert("ØªÙ… Ø§Ù„Ø­Ø°Ù");
loadProducts();
}


// ğŸšª ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬
window.logout=()=>{
signOut(auth);
location.reload();
}

</script>

</body>
</html>
