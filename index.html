<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MIT</title>

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:Arial}
body{background:black;color:white;overflow:hidden}
canvas{position:fixed;top:0;left:0}

/* Logo */
.logo{
position:absolute;
top:25px;
left:50%;
transform:translateX(-50%);
font-size:36px;
letter-spacing:6px;
white-space:nowrap;
z-index:10;
}
.yellow{color:#ffd700}
.red{color:#ff1a1a}

/* Profile */
.profile{
position:absolute;
top:20px;
left:20px;
width:55px;
height:55px;
border-radius:50%;
overflow:hidden;
border:2px solid #ffd700;
cursor:pointer;
z-index:20;
}
.profile img{width:100%;height:100%;object-fit:cover}

/* Menu */
.menu{
position:absolute;
top:50%;
left:50%;
transform:translate(-50%,-50%);
display:flex;
flex-direction:column;
gap:40px;
align-items:center;
z-index:10;
}
.item{
cursor:pointer;
font-size:22px;
letter-spacing:3px;
transition:.3s;
}
.item:hover{transform:scale(1.2)}

/* Section */
.section-title{
position:absolute;
top:90px;
left:50%;
transform:translateX(-50%);
color:#ffd700;
display:none;
z-index:10;
}
.back{
position:absolute;
top:90px;
right:30px;
cursor:pointer;
display:none;
z-index:10;
}

/* Popup */
.popup{
position:fixed;
inset:0;
background:rgba(0,0,0,.9);
display:none;
align-items:center;
justify-content:center;
z-index:50;
}
.box{
background:#111;
padding:25px;
border-radius:15px;
width:280px;
display:flex;
flex-direction:column;
gap:10px;
text-align:center;
}
.box input,.box button{
padding:8px;
border:none;
border-radius:8px;
}
.box button{background:#ffd700;font-weight:bold;cursor:pointer}
</style>
</head>
<body>

<canvas id="space"></canvas>

<div class="profile" onclick="openPopup()">
<img id="profileImg" src="https://cdn-icons-png.flaticon.com/512/149/149071.png">
</div>

<div class="logo">
<span class="yellow">ùîê</span>
<span class="red">ùî¶</span>
<span class="yellow">ùîó</span>
</div>

<div class="section-title" id="sectionTitle"></div>
<div class="back" id="backBtn">BACK</div>

<div class="menu" id="menu">
<div class="item" data-name="HOODIES">HOODIES</div>
<div class="item" data-name="PANTS">PANTS</div>
<div class="item" data-name="ACCESSORIES">ACCESSORIES</div>
</div>

<div class="popup" id="popup">
<div class="box" id="popupContent"></div>
</div>

<script type="module">

/* ================= Firebase ================= */
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword,
signInWithEmailAndPassword, onAuthStateChanged,
updateProfile, signOut }
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

import { getFirestore, doc, setDoc, getDoc }
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig={
apiKey:"AIzaSyA1X_1BlviMDKKUGnA8yfG6NCrfS65h524",
authDomain:"mit-store-bd580.firebaseapp.com",
projectId:"mit-store-bd580",
storageBucket:"mit-store-bd580.firebasestorage.app",
messagingSenderId:"382577223227",
appId:"1:382577223227:web:113177bef81c5afb06de1e"
};

const app=initializeApp(firebaseConfig);
const auth=getAuth(app);
const db=getFirestore(app);

/* ================= Canvas Animation ================= */
const canvas=document.getElementById("space");
const ctx=canvas.getContext("2d");
canvas.width=innerWidth;
canvas.height=innerHeight;

/* Stars */
let stars=[];
for(let i=0;i<250;i++){
stars.push({
x:Math.random()*canvas.width,
y:Math.random()*canvas.height,
speed:Math.random()*0.6+0.2
});
}

function drawStars(){
stars.forEach(s=>{
s.x-=s.speed;
if(s.x<0)s.x=canvas.width;
ctx.fillStyle="white";
ctx.fillRect(s.x,s.y,1.2,1.2);
});
}

/* Local Explosion */
let smokes=[];
let explosionActive=false;
let explosionStart=0;
let explosionX=0;
let explosionY=0;

function createSmoke(){
return{
x:explosionX,
y:explosionY,
r:Math.random()*60+40,
a:1,
angle:Math.random()*Math.PI*2,
speed:Math.random()*3+2
};
}

function startExplosion(x,y){
explosionX=x;
explosionY=y;
explosionActive=true;
explosionStart=Date.now();
smokes=[];

/* Shake */
document.body.style.transition="0.1s";
document.body.style.transform="translate(5px)";
setTimeout(()=>{document.body.style.transform="translate(-5px)";},100);
setTimeout(()=>{document.body.style.transform="translate(0)";},200);
}

function drawSmoke(){
smokes.forEach((s,i)=>{
s.x+=Math.cos(s.angle)*s.speed;
s.y+=Math.sin(s.angle)*s.speed;
s.r+=0.8;
s.a-=0.02;

let g=ctx.createRadialGradient(s.x,s.y,0,s.x,s.y,s.r);
g.addColorStop(0,`rgba(220,220,220,${s.a})`);
g.addColorStop(1,"rgba(0,0,0,0)");

ctx.fillStyle=g;
ctx.beginPath();
ctx.arc(s.x,s.y,s.r,0,Math.PI*2);
ctx.fill();

if(
s.a<=0 ||
s.x<canvas.width*0.2 ||
s.x>canvas.width*0.8 ||
s.y<canvas.height*0.2 ||
s.y>canvas.height*0.8
){
smokes.splice(i,1);
}
});
}

function animate(){
ctx.clearRect(0,0,canvas.width,canvas.height);
drawStars();

if(explosionActive){
if(Date.now()-explosionStart<2000){
for(let i=0;i<8;i++){
smokes.push(createSmoke());
}
}else{
explosionActive=false;
}
}

drawSmoke();
requestAnimationFrame(animate);
}
animate();

/* ================= Sections ================= */
const menu=document.getElementById("menu");
const sectionTitle=document.getElementById("sectionTitle");
const backBtn=document.getElementById("backBtn");

document.querySelectorAll(".item").forEach(item=>{
item.onclick=()=>{
menu.style.display="none";
sectionTitle.style.display="block";
backBtn.style.display="block";
sectionTitle.innerText=item.dataset.name;

const rect=item.getBoundingClientRect();
startExplosion(
rect.left + rect.width/2,
rect.top + rect.height/2
);
};
});

backBtn.onclick=()=>{
menu.style.display="flex";
sectionTitle.style.display="none";
backBtn.style.display="none";
};

/* ================= Popup ================= */
const popup=document.getElementById("popup");
const popupContent=document.getElementById("popupContent");

window.openPopup=()=>{
if(auth.currentUser){showProfile();}
else{showMain();}
popup.style.display="flex";
};

function showMain(){
popupContent.innerHTML=`
<h3>Account</h3>
<button onclick="showLogin()">Login</button>
<button onclick="showRegister()">Create Account</button>
<button onclick="popup.style.display='none'">Close</button>
`;
}

window.showLogin=()=>{
popupContent.innerHTML=`
<h3>Login</h3>
<input id="loginEmail" placeholder="Email">
<input id="loginPass" type="password" placeholder="Password">
<button onclick="login()">Login</button>
<button onclick="showMain()">Back</button>
`;
};

window.showRegister=()=>{
popupContent.innerHTML=`
<h3>Create Account</h3>
<input id="regName" placeholder="Full Name">
<input id="regPhone" placeholder="Phone Number">
<input id="regEmail" placeholder="Email">
<input id="regPass" type="password" placeholder="Password">
<button onclick="register()">Create</button>
<button onclick="showMain()">Back</button>
`;
};

window.register=async()=>{
const u=await createUserWithEmailAndPassword(auth,regEmail.value,regPass.value);
await updateProfile(u.user,{displayName:regName.value});
await setDoc(doc(db,"users",u.user.uid),{
name:regName.value,
phone:regPhone.value,
email:regEmail.value
});
alert("Account Created üî•");
popup.style.display="none";
};

window.login=async()=>{
await signInWithEmailAndPassword(auth,loginEmail.value,loginPass.value);
popup.style.display="none";
};

async function showProfile(){
const user=auth.currentUser;
const snap=await getDoc(doc(db,"users",user.uid));
popupContent.innerHTML=`
<h3>${snap.data().name}</h3>
<p>${snap.data().email}</p>
<p>${snap.data().phone}</p>
<button onclick="logout()">Logout</button>
<button onclick="popup.style.display='none'">Close</button>
`;
}

window.logout=()=>{
signOut(auth);
profileImg.src="https://cdn-icons-png.flaticon.com/512/149/149071.png";
showMain();
};

onAuthStateChanged(auth,(user)=>{
if(user){
profileImg.src="https://cdn-icons-png.flaticon.com/512/4140/4140048.png";
}
});

</script>
</body>
</html>
