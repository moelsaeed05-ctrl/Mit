<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Admin Panel</title>

<style>
body{
background:black;
color:white;
font-family:Arial;
padding:30px;
}

h1{color:#ffd700}

input,select{
width:300px;
padding:10px;
margin:8px 0;
border-radius:8px;
border:none;
}

button{
padding:10px;
background:#ffd700;
border:none;
border-radius:8px;
cursor:pointer;
}

.card{
background:#111;
padding:10px;
margin:10px 0;
border-radius:10px;
}
</style>
</head>
<body>

<h1>MIT Admin Panel</h1>

<input id="email" placeholder="Admin Email">
<input id="password" type="password" placeholder="Password">
<button onclick="login()">Login</button>

<hr>

<div id="adminContent" style="display:none">

<h3>Add Product</h3>

<input id="pName" placeholder="Product Name">
<input id="pPrice" placeholder="Price">

<select id="pCategory">
<option>HOODIES</option>
<option>PANTS</option>
<option>ACCESSORIES</option>
</select>

<input type="file" id="pImage">
<button onclick="addProduct()">Add Product</button>

<hr>

<h3>Statistics</h3>
<p id="stats"></p>

<hr>

<h3>Products</h3>
<div id="productsList"></div>

</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, signInWithEmailAndPassword }
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

import { getFirestore, collection, addDoc,
getDocs, deleteDoc, doc }
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

import { getStorage, ref, uploadBytes, getDownloadURL }
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js";

const firebaseConfig={
apiKey:"AIzaSyA1X_1BlviMDKKUGnA8yfG6NCrfS65h524",
authDomain:"mit-store-bd580.firebaseapp.com",
projectId:"mit-store-bd580",
storageBucket:"mit-store-bd580.appspot.com",
messagingSenderId:"382577223227",
appId:"1:382577223227:web:113177bef81c5afb06de1e"
};

const app=initializeApp(firebaseConfig);
const auth=getAuth(app);
const db=getFirestore(app);
const storage=getStorage(app);

const ADMIN_EMAIL="timofisha@gmail.com";

window.login=()=>{
signInWithEmailAndPassword(auth,email.value,password.value)
.then(user=>{
if(user.user.email===ADMIN_EMAIL){
adminContent.style.display="block";
loadProducts();
loadStats();
}else{
alert("Not Admin âŒ");
}
})
.catch(()=>alert("Login Error âŒ"));
};

window.addProduct=async()=>{
const file=pImage.files[0];
const storageRef=ref(storage,"products/"+file.name);
await uploadBytes(storageRef,file);
const url=await getDownloadURL(storageRef);

await addDoc(collection(db,"products"),{
name:pName.value,
price:pPrice.value,
category:pCategory.value,
image:url
});

alert("Added ðŸ”¥");
loadProducts();
loadStats();
};

async function loadProducts(){
productsList.innerHTML="";
const snap=await getDocs(collection(db,"products"));
snap.forEach(docSnap=>{
const d=docSnap.data();
productsList.innerHTML+=`
<div class="card">
${d.name} - $${d.price}
<button onclick="deleteProduct('${docSnap.id}')">Delete</button>
</div>
`;
});
}

window.deleteProduct=async(id)=>{
await deleteDoc(doc(db,"products",id));
loadProducts();
loadStats();
};

async function loadStats(){
const productsSnap=await getDocs(collection(db,"products"));
stats.innerHTML=`Products: ${productsSnap.size}`;
}

</script>
</body>
</html>
