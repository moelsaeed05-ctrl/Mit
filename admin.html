<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MIT ADMIN</title>

<style>
body{margin:0;background:#000;color:#fff;font-family:Arial;text-align:center}
h1{color:#ffd700;margin-top:20px}
.box{max-width:500px;margin:30px auto;background:#111;padding:25px;border-radius:15px}
input,select{width:100%;padding:10px;margin:8px 0;border:none;border-radius:8px;background:#222;color:#fff}
button{width:100%;padding:10px;margin-top:10px;border:none;border-radius:8px;cursor:pointer;font-weight:bold}
.gold{background:#ffd700;color:#000}
.red{background:#ff3333;color:#fff}
.cyan{background:#00ffcc;color:#000}
.product{background:#1a1a1a;margin:15px 0;padding:15px;border-radius:10px}
.product img{width:100%;border-radius:8px}
.hidden{display:none}
.sizes label{margin:5px;display:inline-block}
</style>
</head>
<body>

<h1>MIT STORE ADMIN</h1>

<div class="box" id="loginBox">
<h3>ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø£Ø¯Ù…Ù†</h3>
<input type="email" id="email" placeholder="Email">
<input type="password" id="password" placeholder="Password">
<button class="gold" id="loginBtn">Login</button>
</div>

<div class="box hidden" id="adminPanel">

<h3>Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬</h3>

<input type="text" id="name" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬">
<input type="text" id="price" placeholder="Ø§Ù„Ø³Ø¹Ø±">

<select id="category">
<option value="">Ø§Ø®ØªØ§Ø± Ø§Ù„Ù†ÙˆØ¹</option>
<option value="HOODIES">HOODIES</option>
<option value="PANTS">PANTS</option>
<option value="ACCESSORIES">ACCESSORIES</option>
</select>

<div id="sizesBox" class="sizes"></div>

<input type="file" id="image">
<button class="gold" id="addBtn">Ø¥Ø¶Ø§ÙØ©</button>

<hr>

<h3>Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h3>
<div id="products"></div>

</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, onAuthStateChanged }
from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, updateDoc }
from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyC6606N-AgsVjpUfubQa9ZRb7VjYtOZvCU",
  authDomain: "mit-store-15e1d.firebaseapp.com",
  projectId: "mit-store-15e1d",
  storageBucket: "mit-store-15e1d.appspot.com",
  messagingSenderId: "168416523904",
  appId: "1:168416523904:web:711219a46f1c87b82e9865"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const loginBox = document.getElementById("loginBox");
const adminPanel = document.getElementById("adminPanel");
const productsDiv = document.getElementById("products");
const sizesBox = document.getElementById("sizesBox");

document.getElementById("loginBtn").onclick = async () => {
  const email = document.getElementById("email").value.trim();
  const pass = document.getElementById("password").value.trim();

  if(!email || !pass){
    alert("Ø§ÙƒØªØ¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");
    return;
  }

  try{
    await signInWithEmailAndPassword(auth,email,pass);
  }catch(error){
    alert(error.code);
  }
};

onAuthStateChanged(auth,user=>{
  if(user){
    loginBox.classList.add("hidden");
    adminPanel.classList.remove("hidden");
    loadProducts();
  }else{
    loginBox.classList.remove("hidden");
    adminPanel.classList.add("hidden");
  }
});

document.getElementById("category").addEventListener("change",()=>{
  const category=document.getElementById("category").value;
  sizesBox.innerHTML="";
  let sizes=[];

  if(category==="HOODIES") sizes=["S","M","L","XL"];
  if(category==="PANTS") sizes=["38","40","42","44"];

  sizes.forEach(size=>{
    sizesBox.innerHTML+=`
    <label>
    <input type="checkbox" value="${size}"> ${size}
    </label>`;
  });
});

document.getElementById("addBtn").onclick = async () => {

  const name=document.getElementById("name").value.trim();
  const price=document.getElementById("price").value.trim();
  const category=document.getElementById("category").value;
  const file=document.getElementById("image").files[0];

  if(!name||!price||!category){
    alert("ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");
    return;
  }

  let selectedSizes=[];
  document.querySelectorAll("#sizesBox input:checked").forEach(el=>{
    selectedSizes.push(el.value);
  });

  let imageURL="";

  if(file){
    const formData=new FormData();
    formData.append("file",file);
    formData.append("upload_preset","unsigned_upload");

    const res=await fetch("https://api.cloudinary.com/v1_1/dh0uqzxpe/image/upload",{
      method:"POST",
      body:formData
    });

    const data=await res.json();

    if(!data.secure_url){
      alert("ÙØ´Ù„ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©");
      return;
    }

    imageURL=data.secure_url;
  }

  await addDoc(collection(db,"products"),{
    name,
    price,
    category,
    sizes:selectedSizes,
    image:imageURL
  });

  alert("ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø¨Ù†Ø¬Ø§Ø­ ğŸ”¥");
  loadProducts();
};

async function loadProducts(){
  productsDiv.innerHTML="";
  const snap=await getDocs(collection(db,"products"));

  snap.forEach(d=>{
    const p=d.data();

    productsDiv.innerHTML+=`
    <div class="product">
      ${p.image ? `<img src="${p.image}">` : ""}
      <h3>${p.name}</h3>
      <div style="color:#ffd700">${p.price}</div>
      <div>${p.category}</div>
      <div>Ø§Ù„Ù…Ù‚Ø§Ø³Ø§Øª: ${p.sizes ? p.sizes.join(", ") : "-"}</div>
      <button class="cyan" onclick="editProduct('${d.id}','${p.name}','${p.price}')">ØªØ¹Ø¯ÙŠÙ„</button>
      <button class="red" onclick="deleteProduct('${d.id}')">Ø­Ø°Ù</button>
    </div>
    `;
  });
}

window.deleteProduct = async function(id){
  await deleteDoc(doc(db,"products",id));
  loadProducts();
};

window.editProduct = async function(id,oldName,oldPrice){
  const newName=prompt("Ø§Ø³Ù… Ø¬Ø¯ÙŠØ¯",oldName);
  const newPrice=prompt("Ø³Ø¹Ø± Ø¬Ø¯ÙŠØ¯",oldPrice);
  if(newName&&newPrice){
    await updateDoc(doc(db,"products",id),{
      name:newName,
      price:newPrice
    });
    loadProducts();
  }
};

</script>

</body>
</html>
