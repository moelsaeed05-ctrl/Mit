<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MIT ADMIN</title>

<style>
body{margin:0;background:black;font-family:Arial;color:white;text-align:center}
h1{color:#ffd700;margin-top:20px}
.box{max-width:500px;margin:30px auto;background:#111;padding:25px;border-radius:15px}
input,select{width:100%;padding:10px;margin:6px 0;border-radius:8px;border:none;background:#222;color:white}
button{padding:10px;border:none;border-radius:8px;margin-top:8px;cursor:pointer}
.gold{background:#ffd700;color:black}
.red{background:#ff3333;color:white}
.cyan{background:#00ffcc;color:black}
.product{background:#1a1a1a;padding:15px;margin:15px 0;border-radius:10px}
.product img{width:100%;border-radius:8px}
.hidden{display:none}
.sizes label{margin:5px;display:inline-block}
</style>
</head>
<body>

<h1>MIT STORE ADMIN</h1>

<div class="box" id="loginBox">
<input type="email" id="email" placeholder="Email">
<input type="password" id="password" placeholder="Password">
<button class="gold" id="loginBtn">Login</button>
</div>

<div class="box hidden" id="adminPanel">

<h3>إضافة منتج</h3>

<input type="text" id="name" placeholder="اسم المنتج">
<input type="text" id="price" placeholder="السعر">

<select id="category">
<option value="">اختار النوع</option>
<option value="HOODIES">HOODIES</option>
<option value="PANTS">PANTS</option>
<option value="ACCESSORIES">ACCESSORIES</option>
</select>

<div id="sizesBox" class="sizes"></div>

<input type="file" id="image">
<button class="gold" id="addBtn">إضافة</button>

<hr>

<h3>المنتجات</h3>
<div id="products"></div>

</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut }
from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, updateDoc }
from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyC6606N-AgsVjpUfubQa9ZRb7VjYtOZvCU",
  authDomain: "mit-store-15e1d.firebaseapp.com",
  projectId: "mit-store-15e1d",
  storageBucket: "mit-store-15e1d.firebasestorage.app",
  messagingSenderId: "168416523904",
  appId: "1:168416523904:web:711219a46f1c87b82e9865"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const loginBox = document.getElementById("loginBox");
const adminPanel = document.getElementById("adminPanel");
const productsDiv = document.getElementById("products");
const sizesBox = document.getElementById("sizesBox");

document.getElementById("loginBtn").onclick = async () => {
  const email = document.getElementById("email").value;
  const pass = document.getElementById("password").value;
  try{
    await signInWithEmailAndPassword(auth,email,pass);
  }catch(e){
    alert(e.code);
  }
};

onAuthStateChanged(auth,user=>{
  if(user){
    loginBox.classList.add("hidden");
    adminPanel.classList.remove("hidden");
    loadProducts();
  }else{
    loginBox.classList.remove("hidden");
    adminPanel.classList.add("hidden");
  }
});

document.getElementById("category").addEventListener("change",()=>{
  const category=document.getElementById("category").value;
  sizesBox.innerHTML="";
  let sizes=[];
  if(category==="HOODIES") sizes=["S","M","L","XL"];
  if(category==="PANTS") sizes=["38","40","42","44"];

  sizes.forEach(size=>{
    sizesBox.innerHTML+=`
    <label>
      <input type="checkbox" value="${size}"> ${size}
    </label>`;
  });
});

document.getElementById("addBtn").onclick = async () => {

  const name=document.getElementById("name").value.trim();
  const price=document.getElementById("price").value.trim();
  const category=document.getElementById("category").value;
  const file=document.getElementById("image").files[0];

  if(!name||!price||!category){
    alert("كمل البيانات");
    return;
  }

  let selectedSizes=[];
  document.querySelectorAll("#sizesBox input:checked").forEach(el=>{
    selectedSizes.push(el.value);
  });

  let imageURL="";

  if(file){
    const formData=new FormData();
    formData.append("file",file);
    formData.append("upload_preset","unsigned_upload");

    const res=await fetch("https://api.cloudinary.com/v1_1/dh0uqzxpe/image/upload",{
      method:"POST",
      body:formData
    });

    const data=await res.json();

    if(!data.secure_url
