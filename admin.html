<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MIT ADMIN</title>

<style>
body{margin:0;background:black;font-family:Arial;color:white;text-align:center}
h1{color:#ffd700;text-shadow:0 0 10px #ffd700;margin-top:20px}
.loginBox,.adminPanel{max-width:450px;margin:40px auto;background:#111;padding:25px;border-radius:15px;box-shadow:0 0 20px #00ffcc}
input,select{width:100%;padding:12px;margin:8px 0;border-radius:8px;border:none;background:#222;color:white}
button{padding:12px;border:none;border-radius:8px;cursor:pointer;margin-top:10px;width:100%;font-weight:bold}
.neonBtn{background:#ffd700;color:black}
.deleteBtn{background:#ff3333;color:white}
.editBtn{background:#00ffcc;color:black}
.product{background:#111;padding:15px;margin:15px 0;border-radius:12px;box-shadow:0 0 10px #00ffcc}
.product img{width:100%;border-radius:10px;margin-bottom:10px}
.stats{margin:15px 0;font-size:18px;color:#00ffcc}
.hidden{display:none}
</style>
</head>
<body>

<h1>MIT STORE ADMIN</h1>

<div class="loginBox" id="loginBox">
<h3>ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø£Ø¯Ù…Ù†</h3>
<input type="email" id="email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">
<input type="password" id="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
<button class="neonBtn" id="loginBtn">Ø¯Ø®ÙˆÙ„</button>
</div>

<div class="adminPanel hidden" id="adminPanel">
<div class="stats" id="stats"></div>

<h3>Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬</h3>
<input type="text" id="name" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬">
<input type="text" id="price" placeholder="Ø§Ù„Ø³Ø¹Ø±">
<select id="category">
<option>HOODIES</option>
<option>PANTS</option>
<option>ACCESSORIES</option>
</select>
<input type="file" id="image">
<button class="neonBtn" id="addBtn">Ø¥Ø¶Ø§ÙØ©</button>

<h3>Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h3>
<div id="products"></div>
</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, onAuthStateChanged }
from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, updateDoc }
from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "mit-store-15e1d.firebaseapp.com",
  projectId: "mit-store-15e1d",
  storageBucket: "mit-store-15e1d.firebasestorage.app",
  messagingSenderId: "168416523904",
  appId: "1:168416523904:web:711219a46f1c87b82e9865"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const loginBox = document.getElementById("loginBox");
const adminPanel = document.getElementById("adminPanel");
const productsDiv = document.getElementById("products");
const stats = document.getElementById("stats");

document.getElementById("loginBtn").onclick = async () => {
  const email = document.getElementById("email").value;
  const pass = document.getElementById("password").value;
  try {
    await signInWithEmailAndPassword(auth,email,pass);
  } catch (e) {
    alert("Ø¨ÙŠØ§Ù†Ø§Øª ØºÙ„Ø·");
  }
};

onAuthStateChanged(auth,user=>{
  if(user){
    loginBox.classList.add("hidden");
    adminPanel.classList.remove("hidden");
    loadProducts();
  }
});

async function loadProducts(){
  productsDiv.innerHTML="";
  const snap=await getDocs(collection(db,"products"));
  let total=0;

  snap.forEach(d=>{
    const p=d.data();
    total++;

    productsDiv.innerHTML+=`
    <div class="product">
    <img src="${p.image}">
    <h3>${p.name}</h3>
    <div style="color:#ffd700">${p.price}</div>
    <div>${p.category}</div>
    <button class="editBtn" onclick="editProduct('${d.id}','${p.name}','${p.price}')">ØªØ¹Ø¯ÙŠÙ„</button>
    <button class="deleteBtn" onclick="deleteProduct('${d.id}')">Ø­Ø°Ù</button>
    </div>`;
  });

  stats.innerHTML=`Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª: ${total}`;
}

document.getElementById("addBtn").onclick = async () => {

  const name = document.getElementById("name").value.trim();
  const price = document.getElementById("price").value.trim();
  const category = document.getElementById("category").value;
  const file = document.getElementById("image").files[0];

  if (!name || !price || !file) {
    alert("ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");
    return;
  }

  const formData = new FormData();
  formData.append("file", file);
  formData.append("upload_preset", "unsigned_upload");

  try {

    const response = await fetch(
      "https://api.cloudinary.com/v1_1/dh0uqzxpe/image/upload",
      { method: "POST", body: formData }
    );

    const data = await response.json();
    console.log(data);

    if(!data.secure_url){
      alert("ÙØ´Ù„ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©");
      return;
    }

    await addDoc(collection(db,"products"),{
      name,
      price,
      category,
      image: data.secure_url
    });

    alert("ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø¨Ù†Ø¬Ø§Ø­ ğŸ”¥");
    document.getElementById("name").value="";
    document.getElementById("price").value="";
    document.getElementById("image").value="";
    loadProducts();

  } catch (error) {
    console.error(error);
    alert("Ø­ØµÙ„ Ø®Ø·Ø£");
  }
};

window.deleteProduct = async (id)=>{
  await deleteDoc(doc(db,"products",id));
  loadProducts();
};

window.editProduct = async (id,oldName,oldPrice)=>{
  const newName=prompt("Ø§Ø³Ù… Ø¬Ø¯ÙŠØ¯",oldName);
  const newPrice=prompt("Ø³Ø¹Ø± Ø¬Ø¯ÙŠØ¯",oldPrice);
  if(newName&&newPrice){
    await updateDoc(doc(db,"products",id),{
      name:newName,
      price:newPrice
    });
    loadProducts();
  }
};

</script>

</body>
</html>
